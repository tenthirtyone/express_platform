'use strict';;(function(){})(),Date.prototype.toDateInputValue=function(){var a=new Date(this);return a.setMinutes(this.getMinutes()-this.getTimezoneOffset()),a.toJSON().slice(0,10)};;(function(){if(0<=$('#Orders').length){var a,b,e,g,h,j,k,l,m,n,o;(function(){var p=function p(E){g=a[E].sort(),r(),q()},q=function q(){k.empty(),k.prepend(ejs.render(n,{fields:h})),$('.fi-x').on('click',function(){var E=$(this).parent().text().trim();$('.select-tile:contains("'+E+'")').removeClass('selected'),-1<h.indexOf(E)&&(h.splice(h.indexOf(E),1),q())}),$('.fi-arrow-up').on('click',function(){var E=$(this).parent().text().trim(),F=h.indexOf(E);0<F&&(h.splice(F-1,0,h.splice(F,1)[0]),q())}),$('.fi-arrow-down').on('click',function(){var E=$(this).parent().text().trim(),F=h.indexOf(E);F<h.length&&(h.splice(F+1,0,h.splice(F,1)[0]),q())})},r=function r(){j.empty(),g=g.map(function(E){return s(E)}),j.prepend(ejs.render(m,{fields:g})),$('.select-tile').on('click',function(){var E=$(this).text().trim();$(this).addClass('selected'),-1===h.indexOf(E)&&(h.push(E),q())})},s=function s(E){return E.replace(/_/g,'.').split('.').map(function(F){return F.charAt(0).toUpperCase()+F.slice(1)}).join(' ')},u=function u(E){return E.replace(/\ /g,'_').toLowerCase()},v=function v(){console.log('Dates');var E=new Date,F=new Date(E);E.setDate(E.getDate()-7);var G=E;console.log(F),console.log(G),$('#StartDate').val(z(G)),$('#EndDate').val(z(F))},w=function w(){l.empty();var E=Object.keys(a).map(function(F){return s(F)});l.append(ejs.render(o,{options:E.sort()})),l.on('click',function(){var F=$(this).children(':selected').text();console.log(u(F)),p(u(F)),h=[],q()})},x=function x(){$('#SelectAll').on('click',function(){$('.select-tile').each(function(E,F){$(F).addClass('selected');var G=$(F).text().trim();-1===h.indexOf(G)&&h.push(G)}),q()}),$('#Reset').on('click',function(){$('.select-tile').each(function(E,F){$(F).removeClass('selected')}),h=[],q()}),$('#Submit').on('click',function(){h.map(function(E){return u(E)}).join(','),y()})},y=function y(){var E=new Date($('#StartDate').val()),F=new Date($('#EndDate').val());$.ajax({url:'/api/orders/report',data:{created_at_min:E,created_at_max:F,page:e},method:'GET',success:function success(G){b=b.concat(G),$('#RecordCount').text(b.length+' Records'),50===G.length?(e++,setTimeout(function(){y()},500)):(C(b),b=[],e=1)}})},z=function z(E){return E.setMinutes(E.getMinutes()-E.getTimezoneOffset()),E.toJSON().slice(0,10)},A=function A(E){return E.length?Object.keys(E[0]):E},B=function B(E){return E.map(function(F){var G=[];for(var H in F)G.push(F[H]);return G})},C=function C(E){var F=$('#SelectList').val(),E=D(E,F),G=A(E);E=B(E),E.unshift(G),console.log(E);//var data = [["name1", "city1", "some other info"], ["name2", "city2", "more info"]];
var H='data:text/csv;charset=utf-8,',I;E.forEach(function(M,N){I=M.join(','),H+=N<E.length?I+'\n':I});var J=encodeURI(H),K=document.createElement('a');K.setAttribute('href',J);var L='NewReport.csv';''!==$('#ReportName').val()&&(L=$('#ReportName').val()+'.csv'),K.setAttribute('download',L),document.body.appendChild(K),K.click()},D=function D(E,F){switch(F){case'Order':return E;break;case'Billing Address':return E.map(function(H){return H.billing_address});break;case'Client Details':return E.map(function(H){return H.client_details});break;case'Customer':return E.map(function(H){return H.customer});break;case'Customer Default Address':return E.map(function(H){return H.customer.default_address});break;case'Discount Codes':return E.map(function(H){return console.log(H),H.discount_codes});break;case'Fulfillments':return E.map(function(H){return console.log(H),H.fulfillments});break;case'Tax Lines':var G=[];return E.forEach(function(H){console.log(H),H.tax_lines.forEach(function(I){console.log(I),G.push(I)})}),G;break;case'Refunds':var G=[];return E.forEach(function(H){console.log(H),H.refunds.forEach(function(I){console.log(I),G.push(I)})}),G;break;case'Refunds Line Items':var G=[];return E.forEach(function(H){console.log(H),H.refunds.forEach(function(I){console.log(I),I.line_items.forEach(function(J){G.push(J)})})}),G;break;case'Refunds Transactions':var G=[];return E.forEach(function(H){console.log(H),H.refunds.forEach(function(I){console.log(I),I.transactions.forEach(function(J){G.push(J)})})}),G;break;case'Refunds Line Items Properties':var G=[];return E.forEach(function(H){console.log(H),H.refunds.forEach(function(I){console.log(I),I.line_items.forEach(function(J){J.properties.forEach(function(K){G.push(K)})})})}),G;break;case'Refunds Line Items Tax Lines':var G=[];return E.forEach(function(H){console.log(H),H.refunds.forEach(function(I){console.log(I),I.line_items.forEach(function(J){J.tax_lines.forEach(function(K){G.push(K)})})})}),G;break;case'Order Line Items':var G=[];return E.forEach(function(H){console.log(H),H.line_items.forEach(function(I){console.log(I),G.push(I)})}),G;break;case'Order Line Items Properties':var G=[];return E.forEach(function(H){console.log(H),H.line_items.forEach(function(I){console.log(I),I.properties.forEach(function(J){console.log(J),G.push(J)})})}),G;break;case'Order Line Items Tax Lines':var G=[];return E.forEach(function(H){console.log(H),H.line_items.forEach(function(I){console.log(I),I.tax_lines.forEach(function(J){console.log(J),G.push(J)})})}),G;break;default:return E;}};a=[],b=[],e=1,g=[],h=[],j=$('#FieldList'),k=$('#ChosenList'),l=$('#SelectList'),m=$('#FieldTemplate').eq(0).html(),n=$('#ChosenTemplate').eq(0).html(),o=$('#SelectTemplate').eq(0).html(),function(F){console.log('init'),$.ajax({url:'/api/orders/fields',method:'GET',success:function success(G){a=G.fields,p(F),w(),v(),x()}})}('orders')})()}})();